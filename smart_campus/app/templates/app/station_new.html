{% extends "app/base.html" %}
{% load static %}

{% block title %}Smart Campus{% endblock %}

{% block stylesheet %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static "app/css/station_new.css" %}" />
  <!-- Include CSS for icons. -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

  <!-- Include Editor style. -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1/css/froala_editor.pkgd.min.css" rel="stylesheet" type="text/css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1/css/froala_style.min.css" rel="stylesheet" type="text/css" />
{% endblock %}

{% block content %}
<div class="ui container">
  <!-- Display Error -->
  {% for field in form %}
    {% for error in field.errors %}
        <li class='text-danger'><strong>{{ field.label }}: {{ error|escape }}</strong></li>
    {% endfor %}
  {% endfor %}
  <!-- Form -->
  <form class="ui centered big form" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="fields">

      <!-- Station Name -->
      <div class="field">
        <label>名稱</label>
        <input id="name" name="name" type="text" placeholder="站點名稱" value="{{ form.cleaned_data.name }}" required="">
      </div>

      <!-- Category Select -->
      <div class="field">
        <label>類別</label>
        <div class="ui selection dropdown">
          <input type="hidden" name="category">
          <i class="dropdown icon"></i>
          <div class="default text">請選擇類別...</div>
          <div class="menu">
            {% if categories %} {% for category in categories %}
            <div class="item" value="{{ category.name }}" data-value="{{ category.name }}">
              {{ category.name }}
            </div>
            {% endfor %} {% endif %}
          </div>
        </div>
      </div>

    </div>
    <hr>
    <!-- Content Textarea -->
    <div class="field">
      <label>推播內容</label>
      <textarea title="height option" target="_blank" form="station_form">{{ form.cleaned_data.content }}</textarea>
    </div>
    <hr>
    <!-- Image Upload Section -->
    <div class="five wide field">
      <label>圖片上傳</label>
      <div class="ui action input">
        <input type="text" placeholder="img 1" readonly="">
        <input id="img1" name="img1" type="file" accept="image/*" style="display: none;">
        <div class="ui icon button">
          <i class="attach icon"></i>
        </div>
      </div>
      <button type="button" id="btn_addimage" name="btn_addimage" class="btn btn-danger" onclick="">新增照片欄位</button>
    </div>

    <!-- Choose Primary photo -->
    <div class="inline field">
      <label>選擇主要照片</label>
      <div class="ui radio checkbox">
        <input type="radio" name="main_img_num" id="radios-1" value="1" checked="checked">
        <label>1</label>
      </div>
    </div>
    <hr>
    <div class="four wide column centered field">
      <label>Beacon位置一覽</label>
      <div id="map" style="height:400px;width:600px"></div>
    </div>
    <div class="field">
      <select id="selectbasic" name="beacon" class="custom-select" required="">
      <option value>請在地圖點選...</option>
      <!-- Template Snippet loading options -->
      {% include "app/_option_snippet.html" with datas=beacons form_data=form.cleaned_data.beacon %}
      </select>
    </div>
    <hr>
    <!-- Beacon Information -->
    <div class="field">
      <label>站點位置(預設為Beacon位置)</label>
      <div class="three wide field">
        <label>緯度</label>
        <input id="lat_input" name="lat" type="number" step="any" placeholder="緯度" class="form-control input-md" required="" value="{{ form.cleaned_data.lat }}">
      </div>
      <div class="three wide field">
        <label>經度</label>
        <input id="lng_input" name="lng" type="number" step="any" placeholder="經度" class="form-control input-md" required="" value="{{ form.cleaned_data.lng }}">
      </div>
    </div>
    <button class="ui fluid teal submit button" type="submit">加入站點</button>
  </form>
  <br>
</div>

{% endblock %}

{% block script %}
  {{ block.super }}
  <script>
    $(function() {
      $('textarea').froalaEditor({
        height: 300
      })
    });
    $('.ui.selection.dropdown').dropdown();
    $(".ui.icon.button").click(function() {
      $(this).parent().find("input:file").click();
    });

    $('input:file', '.ui.action.input')
      .on('change', function(e) {
        var name = e.target.files[0].name;
        $('input:text', $(e.target).parent()).val(name);
      });
      $('.ui.radio.checkbox')
        .checkbox()
      ;
  /*Get location(lat, lng) of beacons,
    In order to show them on the Map*/
  var location_arr = [];

  {% if beacons %}
    {% for beacon in beacons %}
      location_arr.push(['{{ beacon.name }}', {{ beacon.location.y }}, {{ beacon.location.x }}])
    {% endfor %}
  {% endif %}

  var MAX_IMGS = {{ max_imgs }};
  </script>
  <script type="text/javascript" src="{% static 'app/js/station_new.js' %}"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAiIZ8KVmbarK__OmCfefXwySbsAQb-JiM&callback=initMap" async defer></script>
  <!-- Include jQuery lib. -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

  <!-- Include Editor JS files. -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1//js/froala_editor.pkgd.min.js"></script>
{% endblock %}

